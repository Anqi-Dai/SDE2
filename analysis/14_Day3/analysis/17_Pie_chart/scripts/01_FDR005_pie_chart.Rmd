---
title: "Draw the FDR005 pie chart"
author: "Anqi Dai"
date: "5/15/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
library(tidyverse)
library(RColorBrewer)
```

```{r}
# load the data 
final <- read_csv('../../16_THE_PSI/output/day3_sig_events_all_tools_not_filtered_by_PSI.csv')
```


```{r}
# get the data in table right
hex <- c(brewer.pal(n = 8, name = "Dark2"), '#00468B')
hex <- c( "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666","#1B9E77", "#00468B")
  
colorPal <- data_frame(
  type = c('AD','TS','MXE','RI','AF','CE','AA','AL','TE'), 
  color = hex) 

res <- final %>%
          group_by(type) %>%
          summarise(count = n())%>%
          mutate(perc = paste0(round((count / sum(count)) * 100), '%') ) 
  
res <- colorPal %>%
  left_join(res, by = 'type') %>%
          mutate(lbl = paste(type, perc , sep = ' '))

# actually draw the pie chart
png('../figs/FDR005 Splicing type pie chart in SIG events.png',pointsize = 8, res = 300, width = 4, height = 4, units = 'in')
pie(res$count,
    labels = res$lbl, 
    col= res$color,
    cex=0.6)
dev.off() 
```

```{r}
# ggpubr is not sufficient to make customized plot, I will have to do in ggplot
# to manually set the factor level of the lables so that I can control how the portions are arranged 


res %>%  
  mutate(lbl = factor(lbl, levels = c("AD 1%", "TS 11%", "MXE 0%", "RI 57%", "AF 0%", "CE 13%", "AA 3%", "AL 0%", "TE 14%"))) %>% 
  ggplot(aes(x="", y=count, fill=lbl)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start=2) + 
  scale_fill_manual(values=hex) + 
  theme_minimal() +
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    panel.border = element_blank(),
    axis.text = element_blank(),
    panel.grid=element_blank(),
    axis.ticks = element_blank()
  ) 
```

```{r}
# the bar chart with the specific numbers
bar <- final %>%
  group_by(type) %>%
  summarise(cts = n()) %>%
  arrange(desc(cts)) %>% 
  full_join(colorPal, by = 'type')


bar %>% 
  ggbarplot(x ='type', y = 'cts', 
            label = TRUE, 
            color = 'black', fill = 'type',
            palette = bar$color) +
  theme(legend.position = 'none') +
  ggsave('../figs/AS type of the FDR < 0.05 locus.jpg', dpi = 300, width = 10, height = 6)
```

```{r}
# how many unique genes
final %>%
  distinct(ensembl_gene_id) %>%
  nrow
```

