---
title: "Fig1"
author: "Anqi Dai"
date: "2/14/2019"
output: html_document
--- 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
```

```{r}
library(tidyverse)
library(ggpubr)
library(Biobase)
library(knitr)
library(kableExtra)
library(RColorBrewer)
```

## 1A: Pie chart

A pie chart showing the number of types of AS events from all three tools. Merging the rMATS one into the other 2 is pain, but I can and will do that.

### The delta PSI

#### The rMATS result



```{r}
# now find the overlap between the 14 and 89 that is the final results
 
DF <- df14 %>%
  inner_join(df89, by = 'locus')
```

#### The other two 
 
```{r}
# revisiting the whippet and IRfinder combined result
two <- read_csv('../../05_IRfinder/output/Whippet_IRfinder_combined_results_sig_withGeneName.csv') %>%
  mutate(locus = paste(Chr, paste(Start, End, sep='-'),sep=':')) %>%
  rename(tool = Program, type = Type) %>%
  dplyr::select(-Chr, -Start,-End) %>%
  dplyr::select(locus, tool, type, external_gene_name) %>%
  filter(!duplicated(locus)) 
```

```{r}
dup <- intersect(two$locus, DF$locus)

twodup <- two %>%
  filter(locus %in%  dup)

rdub <- DF  %>%
  filter(locus %in%  dup) %>%
  dplyr::select(locus, tool, type)
  
join <- rdub %>%
  full_join(twodup, by = 'locus')

join %>%
  mutate(same = type.x == type.y) %>%
  filter(! same == TRUE)

# so the duplications are all of the same type.
# which is a good thing
rmats_to_join <- DF  %>%
  filter(!locus %in%  dup) %>%
  dplyr::select(locus, tool, type, external_gene_name)

# final merged df
final <- bind_rows(two, rmats_to_join)
```

```{r}
hex <- c(brewer.pal(n = 8, name = "Dark2"), '#00468B')

# draw a pie chart of that
colorPal <- data.frame(type = as.character(names(table(final$type))), 
  color = hex) %>% 
  mutate(color = as.character(color), type = as.character(type))

res <- final %>%
          group_by(type) %>%
          summarise(count = n())%>%
          mutate(perc = paste0(round((count / sum(count)) * 100), '%') ) %>%
          left_join(colorPal, by = 'type') %>%
          mutate(lbl = paste(type, perc , sep = ' '))
  
res <- res[sample(nrow(res), nrow(res)),]
pie(res$count,labels = res$lbl, col= res$color, main = 'Splicing type pie chart in SIG events')

```

### KD and control PSI

```{r}


```

